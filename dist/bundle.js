!function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t){e.exports={BOARD_WIDTH:10,BOARD_HEIGHT:20,LINES_PER_LEVEL:10,ROTATE_LEFT:-1,ROTATE_RIGHT:1,CONTROLS:{LEFT:37,RIGHT:39,DOWN:40,ROTATE_LEFT:65,ROTATE_RIGHT:83,HARD_DROP:32},POINTS:{DOWN:1,HARD_DROP:2,LINES_CLEARED:{1:100,2:300,3:500,4:800}},CELL_COLORS:{0:"#55555",1:"#63BCE6",2:"#E6CE63",3:"#E64EC0",4:"#4EE65B",5:"#E6534E",6:"#E6A44E",7:"#4E6AE6"},PIECES:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,2],[2,2]],[[0,3,0],[3,3,3],[0,0,0]],[[0,4,4],[4,4,0],[0,0,0]],[[5,5,0],[0,5,5],[0,0,0]],[[6,6,6],[6,0,0],[0,0,0]],[[7,7,7],[0,0,7],[0,0,0]]],SEED_PIECES:[0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6]}},function(e,t){let i={};e.exports={publish:(e,t)=>{i[e]&&i[e].forEach(e=>e(t))},subscribe:(e,t)=>{i[e]?i[e].push(t):i[e]=[t];const r=i[e].length-1;return()=>{i[e].splice(r,1)}}}},function(e,t,i){const r=i(3);i(7),document.getElementById("p1-board").getContext("2d"),document.getElementById("next-piece").getContext("2d"),new r},function(e,t,i){const r=i(4),{CONTROLS:s,POINTS:c,LINES_PER_LEVEL:n}=i(0),{publish:o,subscribe:h}=i(1);e.exports=class{constructor(){this.score=0,this.level=1,this.lines=0,this.linesRemaining=10,this.board=new r,this.unsubDrop=h("lowerPiece",this.updateScore.bind(this)),this.unsubClear=h("clearLines",this.clearLines.bind(this)),this.unsubGame=h("gameOver",this.gameOver.bind(this))}start(){this.board.getPieces(),o("draw",{board:this.board.grid,piece:this.board.piece.grid,nextPiece:this.board.nextPiece.grid})}command(e){const t={[s.LEFT]:()=>this.board.movePiece(-1,0),[s.RIGHT]:()=>this.board.movePiece(1,0),[s.DOWN]:(e=1)=>this.board.movePiece(0,1,e),[s.ROTATE_LEFT]:()=>this.board.rotatePiece(this.board.piece,-1),[s.ROTATE_RIGHT]:()=>this.board.rotatePiece(this.board.piece,1),[s.HARD_DROP]:()=>this.board.hardDrop()};e in t&&t[e]()}updateScore(e){this.score+=e}updateLines(e){this.lines+=e,this.linesRemaining<=e&&this.level++,this.linesRemaining=n-this.lines%n}clearLines(e){c.LINES_CLEARED[e]&&(this.updateScore(c.LINES_CLEARED[e]*this.level),this.updateLines(e))}gameOver(){this.unsubDrop(),this.unsubClear(),this.unsubGame()}}},function(e,t,i){const{BOARD_WIDTH:r,BOARD_HEIGHT:s,POINTS:c}=i(0),{pieceList:n,Piece:o}=i(5),{publish:h}=i(1);e.exports=class{constructor(){this.grid=this.createEmptyGrid(),this.piece,this.nextPiece}createEmptyGrid(){return new Array(s).fill(null).map(()=>Array(r).fill(0))}getPieces(){this.piece=this.nextPiece?this.nextPiece:new o(n.getNextPiece()),this.validMove(0,0)||h("gameOver",this.piece),this.nextPiece=new o(n.getNextPiece())}movePiece(e,t,i=c.DOWN){return this.validMove(e,t)?(this.piece.move(e,t),t>0&&h("lowerPiece",t*i),i<c.HARD_DROP&&h("draw",{board:this.grid,piece:this.piece.grid}),!0):(t>0&&this.drop(),!1)}drop(){this.addPieceToBoard(),this.clearLines(),this.getPieces(),h("draw",{board:this.grid,piece:this.piece.grid,nextPiece:this.nextPiece.grid})}hardDrop(){let e=0;for(;this.validMove(0,++e);)continue;this.movePiece(0,e-1,c.HARD_DROP),this.drop()}validMove(e,t){const i=this.piece.x+e,r=this.piece.y+t;return this.piece.grid.every((e,t)=>e.every((e,s)=>0===e||this.isInBounds(i+s,r+t)&&this.isEmpty(i+s,r+t)))}isEmpty(e,t){return 0===this.grid[t][e]}isInBounds(e,t){return e>=0&&e<r&&t<s}rotatePiece(e,t){let i=JSON.parse(JSON.stringify(e.grid));for(let e=0;e<i.length;e++)for(let t=0;t<e;t++)[i[t][e],i[e][t]]=[i[e][t],i[t][e]];t>0?i.forEach(e=>e.reverse()):i.reverse(),e.update(i)}addPieceToBoard(){const e=this.piece.x,t=this.piece.y;this.piece.grid.forEach((i,r)=>{i.forEach((i,s)=>{i>0&&(this.grid[t+r][e+s]=i)})})}clearLines(){let e=0;this.grid.forEach((t,i)=>{t.every(e=>e>0)&&(this.grid.splice(i,1),this.grid.unshift(Array(r).fill(0)),e++)}),e&&h("clearLines",e)}}},function(e,t,i){const{PIECES:r,SEED_PIECES:s,BOARD_WIDTH:c}=i(0),{randomize:n}=i(6);const o=new class{constructor(){this.pieces,this.currIdx,this.reset()}reset(){this.pieces=n(s),this.currIdx=0}getNextPiece(){const e=r[this.pieces[this.currIdx]];return this.currIdx++,this.currIdx>=this.pieces.length&&this.reset(),JSON.parse(JSON.stringify(e))}};e.exports={pieceList:o,Piece:class{constructor(e){this.grid=e,this.x=Math.floor(c/2)-Math.ceil(this.grid[0].length/2),this.y=0}move(e,t){this.x+=e,this.y+=t}update(e){this.grid=e}}}},function(e,t){e.exports={randomize:e=>{let t=e.length-1,i=[...e];for(;t>0;){const e=Math.floor(Math.random()*(t+1));[i[e],i[t]]=[i[t],i[e]],t--}return i}}},function(e,t,i){const{subscribe:r}=i(1),{CELL_COLORS:s}=i(0);e.exports=class{constructor(e,t){this.ctx=e,this.ctxNext=t,this.ctx.strokeStyle="black",this.unsubDraw=r("draw",this.draw.bind(this))}draw(e){e.piece&&this.drawPiece(this.ctx,e.piece,e.piece.x,e.piece.y),e.board&&this.drawBoard(this.ctx,e.board),e.nextPiece&&this.drawPiece(this.ctxNext,e.nextPiece,0,0)}drawBoard(e,t){t.forEach((t,i)=>t.forEach((t,r)=>{e.fillStyle=s[t],e.rect(r,i,1,1)}))}drawPiece(e,t,i,r){t.forEach((t,c)=>t.forEach((t,n)=>{t>0&&(e.fillStyle=s[t],e.rect(i+n,r+c,1,1))}))}}}]);